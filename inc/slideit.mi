<!DOCTYPE html>
[html: lang="en"]
[markit:off]
[wiki:off]
<head>
<meta charset="UTF-8" />
<title>Slide it!</title>
<style>
    #matrix               { position:fixed; }
    section               { position:absolute; transform-origin: 0% 0%; }
    #matrix.printing      { position:relative; }
    .printing section     { position:relative; }
    #matrix, section      { transition: all 0.4s ease-in-out; }
    section:not(.here)    { opacity: 0.2; }
    .flying section:hover { opacity: 1; }
</style>
<script>
var map    = { 
    w      : 950, //792, // Slide's width  (fits both A4 and USletter at 72dpi) 
    h      : 670, //595, // Slide's height
    gap    : 25,  // Gap between slides
    places : [],  // Occupied positions
    scale  : 1,
    matrix : function() {
        return document.getElementById("matrix")
    },
    slides : function() {
        return document.querySelectorAll('section')
    },
    init   : function() {
        // Window size
        var bigW = document.body.clientWidth 
        var bigH = Math.max( // Height computation stollen from jquery  
            document.body.scrollHeight, 
            document.body.offsetHeight, 
            document.documentElement.clientHeight, 
            document.documentElement.scrollHeight, 
            document.documentElement.offsetHeight 
            )
        // Fit Slides into window
        this.scale = Math.min(
                            bigW/(this.w+4*this.gap),
                            bigH/(this.h+4*this.gap)
                            )
        // View port size extending on neighboring slides
        var matrix = this.matrix()
        if ( !matrix.classList.contains("printing") ) {
        matrix.style.height  = this.scale*(this.h+4*this.gap)+"px"
        matrix.style.width   = this.scale*(this.w+4*this.gap)+"px"
        this.pady  = 0.5*(bigH-this.scale*(this.h+4*this.gap)) 
        this.padx  = 0.5*(bigW-this.scale*(this.w+4*this.gap))
    }
        var slides = this.slides()
        var xi=0,yi=-1
        for ( var i=0; i<slides.length; i++){
            // Store occupied position
            var xy = slides[i].dataset.xy || 'x,y+1'
            xy = xy.replace("y",yi).replace("x",xi)
            xy = xy.split(",").map(eval).join(",")
            this.places.push(xy)
            slides[i].dataset.xy=xy
            xi  = eval(xy.split(",")[0])
            yi  = eval(xy.split(",")[1])
            // Set unscaled size to slide
            slides[i].style.width =(this.w-2*this.gap)+"px"
            slides[i].style.height=(this.h-2*this.gap)+"px"
            slides[i].style.padding=this.gap+"px"
            slides[i].style.margin=this.gap+"px"
            slides[i].setAttribute("onclick","cursor.jump("+xy+")")
            slides[i].setAttribute("ondblclick","cursor.dive("+xy+")")
            }
        }
    }
var cursor = { 
    x      :  0 , 
    y      :  0 ,
    here   : function()      { return [this.x,this.y].toString()         } ,
    step   : function(dx,dy) { this.jump( this.x+dx,this.y+dy )          },
    dive   : function( x, y) { flyToggle("pleaseLand"); this.jump(x,y)   }, 
    jump   : function( x, y) { 
                // Jumps only if new position occupied 
                if ( map.places.indexOf([x,y].toString())>= 0) {
                    this.x = x; this.y = y ; slideTo()
                    }
                }
    }
function slideTo(){
    var slides = map.slides()
    var matrix = map.matrix()
    for ( var i=0; i<slides.length; i++){
        if ( matrix.classList.contains("printing") ) {
        // Place slides in printable column
            slides[i].classList.add("here")
            // Fit to paper page
            slides[i].style.transform=""
            //slides[i].style.transform="scale(1.15)"
        } else {
        // Place slides in cursor-centric matrix 
            var xy  = slides[i].dataset.xy
            var pos = xy.split(",").map(eval)
            var tx  =((pos[0]-cursor.x)*(map.w+map.gap)+2*map.gap)*map.scale+map.padx
            var ty  =((pos[1]-cursor.y)*(map.h+map.gap)+2*map.gap)*map.scale+map.pady
            slides[i].style.transform="translate("+tx+"px,"+ty+"px) scale("+map.scale+")"
            // flag current slide
            if ( xy == cursor.here() ) {
                slides[i].classList.add("here")
            } else {
                slides[i].classList.remove("here")
                }
            }
        }
    }
function flyToggle(requestLanding){
    var matrix = map.matrix()
    if ( requestLanding || matrix.classList.contains("flying") ) {
        matrix.classList.remove("flying")
        matrix.style.transform ="scale(1)"
        cursor.jump(cursor.x,cursor.y)
    } else {
        matrix.classList.add("flying")
        matrix.style.transform  ="scale(0.1)"
    }
}
function printToggle(){
    var matrix = map.matrix()
    if ( matrix.classList.contains("printing") ) {
        matrix.classList.remove("printing")
        document.body.style.background = ""
        map.init()
    } else {
        matrix.classList.add("printing")
        document.body.style.background = "#fff"
    }
    cursor.jump(0,0)
}
window.onload    = function(){ map.init() ; cursor.jump(0,0)}
window.onresize  = function(){ map.init() ; slideTo()       }
window.onkeydown = function (evt) {
              if(evt.which === 39){ cursor.step(    1, 0); // Right
        }else if(evt.which === 37){ cursor.step(   -1, 0); // Left
        }else if(evt.which === 40){ cursor.step(    0, 1); // Down
        }else if(evt.which === 38){ cursor.step(    0,-1); // Up
        }else if(evt.which === 36){ cursor.jump(    0, 0); // Home
        }else if(evt.which === 32){ flyToggle();           // Space
        }else if(evt.which === 13){ flyToggle();           // Enter
        }else if(evt.which === 80){ printToggle();         // p
      //}else if(evt.which)       { console.log(evt.which) // Show me the code
        }
    }
</script>
</head>
[markit:on]
[wiki:on]
[body:]
[div:noa id="matrix"]
